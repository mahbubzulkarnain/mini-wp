<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="/css/main.css" type="text/css" rel="stylesheet">
    <link href="/css/nav.css" type="text/css" rel="stylesheet">

    <!--<link href="//cdn.jsdelivr.net/medium-editor/latest/css/medium-editor.min.css" type="text/css" rel="stylesheet">-->
    <link href="/editor/css/medium-editor.css" type="text/css" rel="stylesheet">
    <link href="/editor/css/themes/default.css" type="text/css" rel="stylesheet">


    <script src="https://cdn.jsdelivr.net/npm/vue"></script>

    <script
            src="http://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script type="text/javascript"
            src="//cdn.rawgit.com/FranzSkuffka/vue-medium-editor/0.1.0/dist/vueMediumEditor.min.js"></script>
    <script type="text/javascript" src="/editor/js/medium-editor.js"></script>
    <!--<script type="text/javascript" src="/editor/md/me-markdown.standalone.js"></script>-->

    <script type="text/javascript" src="/js/main.js"></script>

    <script src="/src/components/Tabs.js"></script>
    <!--<script src="/src/components/List.js"></script>-->
</head>
<body>
<section class="section">
    <div id="app">
        <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a class="navbar-item" @click="page = 'list'">
                    <h1 class="title">Hackivity</h1>
                </a>
                <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
                   data-target="navbarBasicExample">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div id="navbarBasicExample" class="navbar-menu">
                <div class="navbar-end">
                    <div class="navbar-item">
                        <div class="buttons">
                            <div v-if="page==='create'">
                                <a @click="createArticle" class="button is-primary">
                                    <strong>Publish</strong>
                                </a>
                            </div>
                            <div v-else-if="page==='edit'">
                                <a @click="updateArticle" class="button is-primary">
                                    <strong>Update</strong>
                                </a>
                            </div>
                            <div v-else>
                                <a @click="page='create'" class="button is-primary">
                                    <strong>Create</strong>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link is-arrowless">
                            <span class="icon"><i class="fa fa-bell"></i></span>
                        </a>
                        <div class="navbar-dropdown is-right">
                            <a class="navbar-item">
                                <strong>Administrator</strong> has comment at <strong>Lorem Ipsum</strong>
                            </a>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link image wrapper is-arrowless">
                            <img class="is-rounded avatar-nav" src="https://bulma.io/images/placeholders/128x128.png">
                        </a>

                        <div class="navbar-dropdown is-right">
                            <a class="navbar-item">
                                Mahbub Zulkarnain
                            </a>
                            <a class="navbar-item">
                                Setting
                            </a>
                            <hr class="navbar-divider">
                            <a class="navbar-item">
                                Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <div class="container" style="margin-top: 20px;">
            <div class="columns">
                <div class="column is-one-fifths">
                    <aside>
                        <ul class="menu-list">
                            <li><a @click="page='create'">Create</a></li>
                            <li><a @click="page='list'">List</a></li>
                        </ul>
                    </aside>
                </div>
                <div class="column is-four-fifths">
                    <div v-if="page === 'list'">
                        <div>
                            <div class="field">
                                <div class="control">
                                    <input class="input" v-model="filterKey" @keyup.enter="filterList"
                                           placeholder="Search...">
                                </div>
                            </div>
                            <tabs>
                                <tab name="Published" :selected="true">
                                    <!--list-->
                                    <div v-if="published.length">
                                        <div v-for="(post, i) in published" class="columns is-multiline">
                                            <div class="column is-full">
                                                <!--list-item-->
                                                <div class="column is-full">
                                                    <div class="card mb-medium">
                                                        <div class="card-content">
                                                            <div class="tags are-medium is-pulled-right">
                                                                <span class="tag is-size-7">{{timeAgo(post.created_at)}} day ago</span>
                                                            </div>
                                                            <div @click="page='read', selected=post._id"
                                                                 class="content">
                                                                <p class="title">{{post.title}}</p>
                                                                <p v-html="marked(post.content || '')"></p>
                                                            </div>
                                                            <div class="content">
                                                                <div class="tags are-medium is-pulled-right">
                                                                    <a @click="page='edit', selected=post._id"
                                                                       class="tag is-info is-size-6">Edit</a>
                                                                    <a @click="selected=post._id, deleteArticle(i)"
                                                                       class="tag is-danger is-size-6">Delete</a>
                                                                </div>
                                                                <div class="tags">
                                                                    <span class="tag">One</span>
                                                                    <span class="tag">Two</span>
                                                                    <span class="tag">Three</span>
                                                                    <span class="tag">Four</span>
                                                                    <span class="tag">Five</span>
                                                                    <span class="tag">Six</span>
                                                                    <span class="tag">Seven</span>
                                                                    <span class="tag">Eight</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--list-item-->
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else>
                                        <div class="columns is-multiline">
                                            <div class="column is-full" style="margin-bottom: 10px;">Not found</div>
                                        </div>
                                    </div>
                                    <div class="columns is-multiline">
                                        <div class="column">
                                            <nav class="pagination is-centered" role="navigation"
                                                 aria-label="pagination">
                                                <a class="pagination-previous">Previous</a>
                                                <a class="pagination-next">Next page</a>
                                                <ul class="pagination-list">
                                                    <li><a class="pagination-link" aria-label="Goto page 1">1</a></li>
                                                    <li><span class="pagination-ellipsis">&hellip;</span></li>
                                                    <li><a class="pagination-link" aria-label="Goto page 5">5</a></li>
                                                    <li><a class="pagination-link is-current" aria-label="Page 6"
                                                           aria-current="page">6</a>
                                                    </li>
                                                    <li><a class="pagination-link" aria-label="Goto page 7">7</a></li>
                                                    <li><span class="pagination-ellipsis">&hellip;</span></li>
                                                    <li><a class="pagination-link" aria-label="Goto page 8">8</a></li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                    <!--list-->
                                </tab>
                                <tab name="Drafts">
                                    <list :posts="drafted"></list>
                                </tab>
                            </tabs>
                        </div>
                    </div>
                    <div v-if="page === 'read'">
                        <div class="column is-full">
                            <div class="card mb-medium">
                                <div class="card-content">
                                    <div class="content">
                                        <div class="title">{{post.title}}</div>
                                        <p v-html="marked(post.content || '')"></p>
                                    </div>
                                    <div class="content">
                                        <div class="tags are-medium is-pulled-right">
                                            <a @click="page='edit', selected=post._id"
                                               class="tag is-info is-size-6">Edit</a>
                                            <a @click="selected=post._id, deleteArticle()"
                                               class="tag is-danger is-size-6">Delete</a>
                                        </div>
                                        <div class="tags"><span class="tag">One</span><span
                                                class="tag">Two</span><span
                                                class="tag">Three</span><span
                                                class="tag">Four</span><span
                                                class="tag">Five</span><span
                                                class="tag">Six</span><span
                                                class="tag">Seven</span><span
                                                class="tag">Eight</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="page === 'create'">
                        <div>

                            <div class="field">
                                <div class="control">
                                    <input v-model="title" class="input" placeholder="Type your title">
                                </div>
                            </div>
                            <hr>
                            <div class="field">
                                <div class="control">
                                    <medium-content
                                            id="editorContent"
                                            ref='editorContent'
                                            v-model="content"
                                            :text='content'
                                            custom-tag='div'
                                            data-placeholder="Type your content"
                                            autofocus
                                    />
                                    <!--<div id="editorContent"></div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="page === 'edit'">
                        <div>

                            <div class="field">
                                <div class="control">
                                    <input v-model="title" class="input" placeholder="Type your title">
                                </div>
                            </div>
                            <hr>
                            <div class="field">
                                <div class="control">
                                    <medium-content
                                            id="editorContent"
                                            ref='editorContent'
                                            v-model="content"
                                            :text='content'
                                            custom-tag='div'
                                            data-placeholder="Type your content"
                                            autofocus
                                    />
                                    <!--<div id="editorContent"></div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script type="text/javascript">
  // var editorTitle = new MediumEditor('#editorTitle', {
  //   placeholder: {
  //     text: 'Type your title'
  //   }
  // });
  // var editorContent = new MediumEditor('#editorContent');
  $(function () {
    var vm = new Vue({
      el: "#app",
      data: {
        selected: '',
        page: 'list',
        list: true,
        read: false,
        create: false,
        edit: false,
        filterKey: '',
        drafted: [],
        post: '',
        title: '',
        content: '',
        published: []
      },
      components: {
        'medium-content': vueMediumEditor.default,
      },
      methods: {
        timeAgo: function (second) {
          let seconds = Math.floor((new Date(Date.now()) - new Date(second)) / 1000);
          let interval = Math.floor(seconds / 31536000);
          if (interval > 1) {
            return interval + " tahun yang lalu";
          }
          interval = Math.floor(seconds / 2592000);
          if (interval > 1) {
            return interval + " bulan yang lalu";
          }
          interval = Math.floor(seconds / 86400);
          if (interval > 1) {
            return interval + " hari yang lalu";
          }
          interval = Math.floor(seconds / 3600);
          if (interval > 1) {
            return interval + " jam yang lalu";
          }
          interval = Math.floor(seconds / 60);
          if (interval > 1) {
            return interval + " menit yang lalu";
          }
          if (!!!+seconds || seconds < 30) {
            return "beberapa saat yang lalu";
          }
          return Math.floor(seconds) + " detik yang lalu";
        },
        deleteArticle: function (index) {
          api
            .delete('/' + this.selected)
            .then(({data}) => {
              if (this.page === 'list') {
                this.published.splice(index, 1);
              }
              this.page = 'list';
            })
            .catch((err) => {
              console.log(err)
            })
        },
        updateArticle: function () {
          this.content = this.$refs.editorContent.api.origElements.innerHTML;
          if (this.content.length > 0 && this.title.length > 0) {
            api
              .put('/' + this.selected, {
                title: this.title,
                content: this.content,
                created_at: new Date()
              })
              .then(({data}) => {
                this.title = '';
                this.content = '';
                this.page = 'read';
              })
              .catch((err) => {
                console.log(err)
              })
          }
        },
        createArticle: function () {
          this.content = this.$refs.editorContent.api.origElements.innerHTML;
          if (this.content.length > 0 && this.title.length > 0) {
            api
              .post('/', {
                title: this.title,
                content: this.content,
                created_at: new Date()
              })
              .then(({data}) => {
                this.title = '';
                this.content = '';
                this.page = 'read';
                this.selected = data.data._id;
              })
              .catch((err) => {
                console.log(err)
              })
          }
        },
        filterList: function () {
          api
            .get('/', {
              params: {
                filter: this.filterKey
              }
            })
            .then(({data}) => {
              this.published = data;
            })
            .catch((err) => {
              console.log(err)
            })
        }
      },
      watch: {
        page: function (newPage, oldPage) {
          if (newPage !== oldPage) {
            if (oldPage === 'edit') {
              this.title = '';
              this.content = '';
            }
            switch (newPage) {
              case 'read':
                api
                  .get('/' + this.selected)
                  .then(({data}) => {
                    this.post = data
                  })
                  .catch((err) => {
                    console.log(err)
                  });
                break;
              case 'edit':
                api
                  .get('/' + this.selected)
                  .then(({data}) => {
                    this.title = data.title;
                    this.content = data.content;
                    this.$refs.editorContent.api.origElements.innerHTML = this.content;
                  })
                  .catch((err) => {
                    console.log(err)
                  });
                break;
              case 'list':
                api
                  .get('/')
                  .then(({data}) => {
                    this.published = data;
                  })
                  .catch((err) => {
                    console.log(err)
                  });
                break;
              case 'create':
                break;
            }
          }
        }
      },
      mounted() {
        api
          .get('/')
          .then(({data}) => {
            this.published = data;
          })
          .catch((err) => {
            console.log(err)
          });
      }
    });
  })
</script>
</body>
</html>